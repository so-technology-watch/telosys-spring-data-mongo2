/*
 * Created on $today.date ( Time $today.time )
 * Generated by $generator.name ( version $generator.version )
 */
package ${target.javaPackageFromFolder($TEST_SRC)};

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;

import java.util.logging.Logger;

import org.demo.data.record.AuthorRecord;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.springframework.data.mongodb.core.MongoTemplate;

/**
 * Spring Mongo Sequence class Integration Test <br>
 * 
 * @author Telosys 
 *
 */
public class SequenceDAOTest {
	
	private MongoTemplate mongoTemplate;
	private static final Logger LOGGER = Logger.getLogger(SequenceDAOTest.class.getName());

	
	@Before
	public void setUp() throws Exception {
		mongoTemplate = SpringMongoTemplate.getMongotemplate();
	}

	@After
	public void tearDown() throws Exception {
		mongoTemplate.dropCollection(AuthorRecord.class);
	}

	@Test
	public void test1() throws Exception {
		LOGGER.info("--- test1");
    	SequenceDAO sequence = new SequenceDAO(mongoTemplate,"seqTest");

    	assertEquals( 0L, sequence.currVal("seqTest") );

    	assertEquals( 1L, sequence.nextVal("seqTest") );
    	LOGGER.info("Sequence currVal() = " + sequence.currVal("seqTest") );
    	
    	for ( int i=0 ; i < 10 ; i++ ) {
        	sequence.nextVal("seqTest") ;
    	}
    	LOGGER.info("Sequence currVal() = " + sequence.currVal("seqTest") );
    	assertEquals( 11L, sequence.currVal("seqTest") );

		boolean b = sequence.delete("seqTest");
        assertTrue(b);
        LOGGER.info("Sequence deleted");	
	}	
}
